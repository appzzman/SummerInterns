<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Summer Internships</title>

    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 350px;
        width:100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>

    <script>
    "use strict";
    </script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css">

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="  crossorigin="anonymous"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap.min.js"></script>
    <!-- https://datatables.net/examples/styling/bootstrap.html -->

    <script src="https://use.fontawesome.com/da66ce1fd6.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rsvp/3.5.0/rsvp.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.8.0/firebase.js"></script>

    <script src="scripts/script.js"> </script>


    <script>
    var globalContacts = []
    var globalOptions = []


     function createCell(text, row){
       var cell= $('<td></td>');
       cell.text(text)
       row.append(cell)
     }


     function updateContactRow(option,row, key){
       console.log(row);

       createCell(option.fullname,row)
       createCell(option.phone,row)
       createCell(option.fax,row)
       createCell(option.address,row)
       createCell(option.website,row)
       createCell(option.email,row)
       return row

     }
     function updateOptionRow(option,row, key){

        createCell(option.fullname,row)
        createCell(option.start,row)
        createCell(option.end,row)
        createCell(option.price,row)
        createCell(option.rate,row)
        createCell(option.days,row)
        createCell(option.bedrooms,row)
        createCell(option.bathrooms,row)
        // createCell(option.short,row)

        var cell = $('<td></td>');
        cell.html("<a href='#"+key+"'>Contact Information</a>")
        row.append(cell)
        return row
     }

     function updateContactsTable(contacts){
       console.log(contacts);
        var table = $("#contactsTable")
        contacts.forEach(function(uv){
            console.log(uv);
            //Each option should have own row
            var row = $('<tr></tr>');
            updateContactRow(uv,row, null)
            table.append(row)

        });
     }

     /**Rendering Table*/
     function updateOptionsTable(options){
       var table = $("#optionsTable")
       //Options
       options.forEach(function(uv){

        for (var key in uv){
          if(uv.hasOwnProperty(key)){
              if(key === "key"){ //Skip it

              }
              else{
                //Each option should have own row
                var row = $('<tr></tr>');
                updateOptionRow(uv[key],row, uv.key)
                table.append(row)
              }
          }
        }
     });
     }

     $(document).ready(function() {
        //

        getCollection('options').then(function(options){
             globalOptions = options
             updateOptionsTable(globalOptions)
             $('#optionsTable').DataTable();
        });

        getCollection('contact').then(function(contacts){
               globalContacts = contacts
               updateContactsTable(contacts)
        });

      } )



    </script>


  </head>
  <body>
    <div class="container">
    <div class="row">
        <div id="map" class="col-md-12"> </div>
    </div>

    <div class="clearfix visible-xs-block"></div>
    <div class="row">
    <div id="contacts">
      <table border="1" id="optionsTable" class="table table-striped table-bordered">
        <thead>
        <tr>
           <th>Institution</th><th>Date Start</th><th>Date End</th><th>Price</th><th>Nightly Rate</th><th>Nights</th><th>Bedrooms</th><th>Bathrooms</th><th>Contact</th>
        </tr>
      </thead>
      <tbody>

      </tbody>
    </table>

     </div>
   </div>

   <div class="row">
     <table border="1" id="contactsTable" class="table table-striped table-bordered">
       <thead>
        <tr>
          <th>Institution</th><th><i class="fa fa-phone" aria-hidden="true"></i>Phone</th><th><i class="fa fa-fax" aria-hidden="true"></i>Fax</th><th>Address</th><th>Website</th><th><i class="fa fa-email" aria-hidden="true"></i>Email</th>
        </tr>
     </thead>
     <tbody>
  
     </tbody>
    </table>

   </div><!-- Contact Table -->
 </div> <!-- Container -->
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBjQKE5--yWVysS8i2kiUeSTjPFd1cQy9U&callback=initMap">
    </script>
  </body>
</html>
