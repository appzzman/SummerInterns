<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Summer Internships</title>

    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 350px;
        width:100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>

    <script>
    "use strict";
    </script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css">

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="  crossorigin="anonymous"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap.min.js"></script>
    <!-- https://datatables.net/examples/styling/bootstrap.html -->

    <script src="https://use.fontawesome.com/da66ce1fd6.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rsvp/3.5.0/rsvp.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.8.0/firebase.js"></script>

    <script src="scripts/script.js"> </script>


    <script>
    var globalContacts = []
    var globalOptions = []


    function toggleBounce(e) {

        var lat = e.latLng.lat()
        var lng = e.latLng.lng()

        var filtered = globalContacts.filter(function(el){
          return round(el.latitude,4) === round(lat,4) &&  round(el.longitude,4) === round(lng,4)
        })
     }

     function createCell(text, row){
       var cell= $('<td></td>');
       cell.text(text)
       row.append(cell)
     }


     function updateOptionRow(option,row, key){
      //             <th>Institution</th><th>Date Start</th><th>Date End</th><th>Price</th><th>Nightly Rate</th><th>Nights</th><th>Bedrooms</th><th>Bathrooms</th><th>Map</th><th>Contact</th>
      //Create cells
        console.log(option);
        createCell(option.fullname,row)
        createCell(option.start,row)
        createCell(option.end,row)
        createCell(option.price,row)
        createCell(option.rate,row)
        createCell(option.days,row)
        createCell(option.bedrooms,row)
        createCell(option.bathrooms,row)
        // createCell(option.short,row)

        var cell = $('<td></td>');
        cell.html("<a href='#"+key+"'>Contact Information</a>")
        row.append(cell)
        //
        // var start = $('<td></td>');
        // start.text(option.start)
        // row.append(start)
        //
        // var end = $('<td></td>');
        // end.text(option.end)
        // row.append(end)



        // var tt = 'fullname'
        // console.log(option.tt);
        // var t = option["fullname"]
        // console.log(t);

        return row
     }

     function updateContactsTable(contacts){
        var table = $("#contactsTable")

     }
     /**Rendering Table*/
     function updateOptionsTable(options){


       var table = $("#optionsTable")
      //  console.log(options);

      console.log(options);

       //Options
       options.forEach(function(uv){

        for (var key in uv){
          if(uv.hasOwnProperty(key)){
              if(key === "key"){ //Skip it

              }
              else{
                //Each option should have own row
                var row = $('<tr></tr>');
                updateOptionRow(uv[key],row, uv.key)
                table.append(row)
              }
          }
        }
     });
     }

     $(document).ready(function() {
        //

        getCollection('options').then(function(options){
             globalOptions = options
             updateOptionsTable(globalOptions)
             $('#optionsTable').DataTable();
        });

        getCollection('contact').then(function(contacts){
               globalContacts = contacts
               updateContactsTable(contacts)
        });

      } )



    </script>


  </head>
  <body>
    <div id="map"></div>
    <div id="contacts">
      <table border="1" id="optionsTable" class="table table-striped table-bordered">
        <thead>
        <tr>
           <th>Institution</th><th>Date Start</th><th>Date End</th><th>Price</th><th>Nightly Rate</th><th>Nights</th><th>Bedrooms</th><th>Bathrooms</th><th>Contact</th>
        </tr>
      </thead>
      <tbody>

      </tbody>
      <table>

        <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

        <table border="1" id="contactTable" class="table table-striped table-bordered">
          <thead>
           <tr>
             <th>Institution</th><th><i class="fa fa-phone" aria-hidden="true"></i>Phone</th><th><i class="fa fa-fax" aria-hidden="true"></i>Fax</th><th>Address</th><th>Website</th><th><i class="fa fa-email" aria-hidden="true"></i>Email</th>
           </tr>
        </thead>
        <tbody>
          <tr><td id="FAUContact">May 14 2017</td><td>8/8/2017</td><td>$3,250.00</td><td>$37.79</td><td>80</td><td><i class="fa fa-fax" aria-hidden="true"></i>Fax: 90 90 191 </td></tr>

        </tbody>
        <table>


     </div>

    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBjQKE5--yWVysS8i2kiUeSTjPFd1cQy9U&callback=initMap">
    </script>
  </body>
</html>
